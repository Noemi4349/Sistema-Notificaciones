<div class="credit-management-container">

  <!-- üéØ HERO SECTION - Programaci√≥n Autom√°tica -->
  <section class="scheduler-hero">
    <div class="scheduler-card glass-effect">
      
      <!-- Header con gradiente -->
      <div class="scheduler-header">
        <div class="header-content">
          <div class="title-group">
            <div class="icon-badge pulse-animation">
              <i class="pi pi-clock"></i>
            </div>
            <div>
              <h2 class="main-title">Programaci√≥n Autom√°tica</h2>
              <p class="subtitle">Sistema inteligente de recordatorios</p>
            </div>
          </div>
          <p-button
            icon="pi pi-cog"
            label="Configurar"
            severity="info"
            (onClick)="abrirConfiguracionScheduler()">
          </p-button>
        </div>
      </div>

      <!-- Grid de Estado del Scheduler -->
      <div *ngIf="configuracionScheduler" class="scheduler-grid">
        
        <!-- Card Estado -->
        <div class="stat-card status-card" [class.active]="schedulerActivo">
          <div class="stat-icon-wrapper">
            <i [class]="schedulerActivo ? 'pi pi-check-circle' : 'pi pi-pause-circle'"></i>
          </div>
          <div class="stat-content">
            <span class="stat-label">Estado del Sistema</span>
            <span class="stat-value">{{ schedulerActivo ? 'Activo' : 'Inactivo' }}</span>
            <div class="status-indicator" [class.active]="schedulerActivo">
              <span class="pulse-dot"></span>
              {{ schedulerActivo ? 'En l√≠nea' : 'Pausado' }}
            </div>
          </div>
        </div>

        <!-- Card Hora Programada -->
        <div class="stat-card time-card">
          <div class="stat-icon-wrapper">
            <i class="pi pi-clock"></i>
          </div>
          <div class="stat-content">
            <span class="stat-label">Hora Programada</span>
            <span class="stat-value">{{ formatearHora(configuracionScheduler.hora, configuracionScheduler.minuto) }}</span>
            <div *ngIf="schedulerActivo && tiempoRestante" class="countdown">
              <i class="pi pi-hourglass"></i>
              <span>{{ tiempoRestante }}</span>
            </div>
          </div>
        </div>

        <!-- Card D√≠as de Anticipaci√≥n -->
        <div class="stat-card days-card">
          <div class="stat-icon-wrapper">
            <i class="pi pi-calendar"></i>
          </div>
          <div class="stat-content">
            <span class="stat-label">D√≠as de Anticipaci√≥n</span>
            <span class="stat-value">{{ configuracionScheduler.diasAnticipacion }}</span>
            <span class="stat-unit">d√≠a(s) antes</span>
          </div>
        </div>

        <!-- Card Acci√≥n Manual -->
        <div class="stat-card action-card">
          <div class="stat-icon-wrapper">
            <i class="pi pi-bolt"></i>
          </div>
          <div class="stat-content">
            <span class="stat-label">Ejecuci√≥n Manual</span>
            <p-button
              label="Ejecutar Ahora"
              icon="pi pi-play"
              severity="success"
              (onClick)="ejecutarEnvioInmediato()"
              [loading]="loadingEnvio">
            </p-button>
          </div>
        </div>

      </div>

      <!-- Loading State -->
      <div *ngIf="loadingConfiguracion" class="loading-state">
        <i class="pi pi-spin pi-spinner"></i>
        <p>Cargando configuraci√≥n del sistema...</p>
      </div>

    </div>
  </section>

  <!-- üíº SECCI√ìN PRINCIPAL DE GESTI√ìN -->
  <section class="management-section">
    <div class="management-card">

      <!-- Header Principal -->
      <div class="main-header">
        <div class="header-left">
          <div class="icon-badge-large">
            <i class="pi pi-credit-card"></i>
          </div>
          <div>
            <h1 class="page-title">Gesti√≥n de Cr√©ditos</h1>
            <p class="page-description">Control y seguimiento de recordatorios a socios</p>
          </div>
        </div>

        <div class="action-buttons">
          <p-button
            label="Env√≠o Masivo"
            icon="pi pi-send"
            severity="primary"
            (onClick)="ejecutarEnvioMasivo()"
            [loading]="loadingEnvio">
          </p-button>

          <p-button
            label="Test"
            icon="pi pi-mobile"
            severity="secondary"
            (onClick)="abrirDialogTest()">
          </p-button>

          <p-button
            label="Registros"
            icon="pi pi-chart-bar"
            severity="help"
            (onClick)="abrirRegistros()">
          </p-button>

          <p-button
            label="Calendario"
            icon="pi pi-calendar"
            severity="info"
            [outlined]="true"
            (onClick)="abrirCalendario()">
          </p-button>
        </div>
      </div>

      <!-- üìä Dashboard de Estad√≠sticas -->
      <div *ngIf="estadisticas" class="stats-dashboard">
        <div class="dashboard-card envios-card">
          <div class="dashboard-icon">
            <i class="pi pi-send"></i>
          </div>
          <div class="dashboard-content">
            <span class="dashboard-value">{{ estadisticas.totalEnvios }}</span>
            <span class="dashboard-label">Total Env√≠os</span>
          </div>
          <div class="card-decoration"></div>
        </div>

        <div class="dashboard-card exitosos-card">
          <div class="dashboard-icon">
            <i class="pi pi-check-circle"></i>
          </div>
          <div class="dashboard-content">
            <span class="dashboard-value">{{ estadisticas.enviosExitosos }}</span>
            <span class="dashboard-label">Exitosos</span>
          </div>
          <div class="card-decoration"></div>
        </div>

        <div class="dashboard-card fallidos-card">
          <div class="dashboard-icon">
            <i class="pi pi-times-circle"></i>
          </div>
          <div class="dashboard-content">
            <span class="dashboard-value">{{ estadisticas.enviosFallidos }}</span>
            <span class="dashboard-label">Fallidos</span>
          </div>
          <div class="card-decoration"></div>
        </div>

        <div class="dashboard-card tasa-card">
          <div class="dashboard-icon">
            <i class="pi pi-percentage"></i>
          </div>
          <div class="dashboard-content">
            <span class="dashboard-value">{{ estadisticas.tasaExito | number:'1.1-1' }}%</span>
            <span class="dashboard-label">Tasa de √âxito</span>
          </div>
          <div class="card-decoration"></div>
        </div>
      </div>

      <!-- üîç Barra de Filtros Moderna -->
      <div class="filters-bar">
        <div class="search-wrapper">
          <i class="pi pi-search"></i>
          <input 
            type="text" 
            pInputText 
            [(ngModel)]="busquedaGlobal"
            (input)="aplicarFiltros()"
            placeholder="Buscar por nombre, tel√©fono o email..." 
            class="search-input"/>
        </div>

        <div class="filter-toggle">
          <p-selectButton 
            [options]="[
              {label: 'üìã Todos', value: 'TODOS'},
              {label: '‚úÖ Activos', value: 'ACTIVOS'},
              {label: '‚è∏Ô∏è Inactivos', value: 'INACTIVOS'}
            ]" 
            [(ngModel)]="filtroEstado"
            (onChange)="aplicarFiltros()"
            optionLabel="label"
            optionValue="value">
          </p-selectButton>
        </div>
      </div>

      <!-- üìã Tabla Moderna de Socios -->
      <div class="table-container">
        <p-table
          [value]="sociosFiltrados"
          [paginator]="true"
          [rows]="10"
          [loading]="loading"
          responsiveLayout="scroll"
          styleClass="modern-table"
          [rowHover]="true"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} socios">

          <ng-template pTemplate="caption">
            <div class="table-header">
              <div class="table-title">
                <i class="pi pi-users"></i>
                <span>Lista de Socios ({{ sociosFiltrados.length }})</span>
              </div>
              <p-button   
                label="Agregar Socio" 
                icon="pi pi-user-plus"
                severity="success"
                (onClick)="abrirDialogNuevo()">
              </p-button>
            </div>
          </ng-template>

          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="numeroSocio">
                <div class="header-cell">
                  N¬∫ Socio
                  <p-sortIcon field="numeroSocio"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="nombre">
                <div class="header-cell">
                  Nombre Completo
                  <p-sortIcon field="nombre"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="telefono">
                <div class="header-cell">
                  Tel√©fono
                  <p-sortIcon field="telefono"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="email">
                <div class="header-cell">
                  Email
                  <p-sortIcon field="email"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="fechaVencimientoPago">
                <div class="header-cell">
                  Vencimiento
                  <p-sortIcon field="fechaVencimientoPago"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="estado">
                <div class="header-cell">
                  Estado
                  <p-sortIcon field="estado"></p-sortIcon>
                </div>
              </th>
              <th class="actions-header">Acciones</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-socio>
            <tr class="table-row">
              <td>
                <span class="numero-socio">{{ socio.numeroSocio }}</span>
              </td>
              <td>
                <div class="nombre-completo">
                  <div class="avatar">{{ getInitials(socio.nombre, socio.apellidoPaterno) }}</div>
                  <span>{{ socio.nombre }} {{ socio.apellidoPaterno }} {{ socio.apellidoMaterno }}</span>
                </div>
              </td>
              <td>
                <div class="contact-info">
                  <i class="pi pi-phone"></i>
                  <span>{{ socio.telefono }}</span>
                </div>
              </td>
              <td>
                <div class="contact-info">
                  <i class="pi pi-envelope"></i>
                  <span>{{ socio.email }}</span>
                </div>
              </td>
              <td>
                <div class="vencimiento-cell">
                  <span class="fecha">{{ formatearFecha(socio.fechaVencimientoPago) }}</span>
                  <p-tag
                    [value]="getTextoVencimiento(socio.fechaVencimientoPago)"
                    [severity]="getDiasRestantes(socio.fechaVencimientoPago) < 0 ? 'danger' : (getDiasRestantes(socio.fechaVencimientoPago) <= 1 ? 'warn' : 'success')">
                  </p-tag>
                </div>
              </td>
              <td>
                <p-tag 
                  [value]="getEstadoTexto(socio.estado)" 
                  [severity]="getEstadoBadge(socio.estado)"
                  [icon]="socio.estado ? 'pi pi-check' : 'pi pi-times'">
                </p-tag>
              </td>
              <td>
                <div class="action-buttons-cell">
                  <p-button
                    icon="pi pi-send"
                    [rounded]="true"
                    [text]="true"
                    severity="info"
                    (onClick)="enviarRecordatorio(socio)"
                    [loading]="loadingEnvio"
                    pTooltip="Enviar recordatorio"
                    tooltipPosition="top">
                  </p-button>
                  <p-button
                    icon="pi pi-history"
                    [rounded]="true"
                    [text]="true"
                    severity="help"
                    (onClick)="verHistorial(socio)"
                    pTooltip="Ver historial"
                    tooltipPosition="top">
                  </p-button>
                  <p-button
                    icon="pi pi-pencil"
                    [rounded]="true"
                    [text]="true"
                    severity="secondary"
                    (onClick)="abrirDialogEditar(socio)"
                    pTooltip="Editar"
                    tooltipPosition="top">
                  </p-button>
                  <p-button
                    [icon]="socio.estado ? 'pi pi-ban' : 'pi pi-check'"
                    [rounded]="true"
                    [text]="true"
                    [severity]="socio.estado ? 'warn' : 'success'"
                    (onClick)="cambiarEstado(socio)"
                    [pTooltip]="socio.estado ? 'Desactivar' : 'Activar'"
                    tooltipPosition="top">
                  </p-button>
                  <p-button
                    icon="pi pi-trash"
                    [rounded]="true"
                    [text]="true"
                    severity="danger"
                    (onClick)="eliminarSocio(socio)"
                    pTooltip="Eliminar"
                    tooltipPosition="top">
                  </p-button>
                </div>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="7">
                <div class="empty-state">
                  <div class="empty-icon">
                    <i class="pi pi-inbox"></i>
                  </div>
                  <h3>No hay socios registrados</h3>
                  <p>Comience agregando un nuevo socio al sistema</p>
                  <p-button 
                    label="Agregar Primer Socio" 
                    icon="pi pi-plus"
                    severity="success"
                    (onClick)="abrirDialogNuevo()">
                  </p-button>
                </div>
              </td>
            </tr>
          </ng-template>

        </p-table>
      </div>

    </div>
  </section>

</div>

<!-- üé® DI√ÅLOGO: Configuraci√≥n del Scheduler -->
<p-dialog 
  [(visible)]="displayConfiguracionDialog" 
  [modal]="true" 
  [style]="{width: '600px'}"
  [draggable]="false"
  [resizable]="false"
  header="‚öôÔ∏è Configuraci√≥n del Scheduler">
  
  <div class="dialog-content">
    <div class="form-grid">
      
      <!-- Estado del Scheduler -->
      <div class="form-field full-width">
        <label class="form-label">
          <i class="pi pi-power-off"></i>
          Estado del Sistema
        </label>
        <div class="toggle-container">
          <p-checkbox 
            [(ngModel)]="schedulerActivo" 
            [binary]="true"
            inputId="schedulerActivo"
            label="Scheduler Activo">
          </p-checkbox>
        </div>
      </div>

      <!-- Hora de Env√≠o -->
      <div class="form-field">
        <label for="hora" class="form-label">
          <i class="pi pi-clock"></i>
          Hora (0-23)
        </label>
        <p-inputNumber 
          [(ngModel)]="horaEnvio" 
          inputId="hora"
          [min]="0" 
          [max]="23"
          [showButtons]="true"
          placeholder="09">
        </p-inputNumber>
      </div>

      <!-- Minutos de Env√≠o -->
      <div class="form-field">
        <label for="minuto" class="form-label">
          <i class="pi pi-clock"></i>
          Minutos (0-59)
        </label>
        <p-inputNumber 
          [(ngModel)]="minutoEnvio" 
          inputId="minuto"
          [min]="0" 
          [max]="59"
          [showButtons]="true"
          placeholder="00">
        </p-inputNumber>
      </div>

      <!-- D√≠as de Anticipaci√≥n -->
      <div class="form-field full-width">
        <label for="diasAnticipacion" class="form-label">
          <i class="pi pi-calendar"></i>
          D√≠as de Anticipaci√≥n
        </label>
        <p-inputNumber 
          [(ngModel)]="diasAnticipacion" 
          inputId="diasAnticipacion"
          [min]="1" 
          [max]="30"
          [showButtons]="true"
          placeholder="1">
        </p-inputNumber>
        <small class="form-hint">Los recordatorios se enviar√°n X d√≠as antes del vencimiento</small>
      </div>

    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      icon="pi pi-times" 
      (onClick)="displayConfiguracionDialog = false" 
      severity="secondary"
      [text]="true">
    </p-button>
    <p-button 
      label="Guardar Configuraci√≥n" 
      icon="pi pi-check" 
      (onClick)="guardarConfiguracionScheduler()"
      [loading]="loadingConfiguracion">
    </p-button>
  </ng-template>
</p-dialog>

<!-- üé® DI√ÅLOGO: Agregar/Editar Socio -->
<p-dialog 
  [(visible)]="displayDialog" 
  [modal]="true" 
  [style]="{width: '700px'}"
  [draggable]="false"
  [resizable]="false"
  [header]="esEdicion ? '‚úèÔ∏è Editar Socio' : '‚ûï Nuevo Socio'">
  
  <div class="dialog-content">
    <div class="form-grid">
      
      <!-- N√∫mero de Socio -->
      <div class="form-field">
        <label for="numeroSocio" class="form-label">
          <i class="pi pi-hashtag"></i>
          N√∫mero de Socio *
        </label>
        <input 
          type="text" 
          pInputText 
          id="numeroSocio"
          [(ngModel)]="socioForm.numeroSocio" 
          placeholder="Ej: SOC-001"
          class="form-input"/>
      </div>

      <!-- Nombre -->
      <div class="form-field">
        <label for="nombre" class="form-label">
          <i class="pi pi-user"></i>
          Nombre *
        </label>
        <input 
          type="text" 
          pInputText 
          id="nombre"
          [(ngModel)]="socioForm.nombre" 
          placeholder="Nombre"
          class="form-input"/>
      </div>

      <!-- Apellido Paterno -->
      <div class="form-field">
        <label for="apellidoPaterno" class="form-label">
          <i class="pi pi-user"></i>
          Apellido Paterno *
        </label>
        <input 
          type="text" 
          pInputText 
          id="apellidoPaterno"
          [(ngModel)]="socioForm.apellidoPaterno" 
          placeholder="Apellido Paterno"
          class="form-input"/>
      </div>

      <!-- Apellido Materno -->
      <div class="form-field">
        <label for="apellidoMaterno" class="form-label">
          <i class="pi pi-user"></i>
          Apellido Materno
        </label>
        <input 
          type="text" 
          pInputText 
          id="apellidoMaterno"
          [(ngModel)]="socioForm.apellidoMaterno" 
          placeholder="Apellido Materno"
          class="form-input"/>
      </div>

      <!-- Tel√©fono -->
      <div class="form-field">
        <label for="telefono" class="form-label">
          <i class="pi pi-phone"></i>
          Tel√©fono *
        </label>
        <input 
          type="text" 
          pInputText 
          id="telefono"
          [(ngModel)]="socioForm.telefono" 
          placeholder="59175123456"
          class="form-input"/>
        <small class="form-hint">Incluir c√≥digo de pa√≠s (Ej: 59175123456)</small>
      </div>

      <!-- Email -->
      <div class="form-field">
        <label for="email" class="form-label">
          <i class="pi pi-envelope"></i>
          Email *
        </label>
        <input 
          type="email" 
          pInputText 
          id="email"
          [(ngModel)]="socioForm.email" 
          placeholder="correo@ejemplo.com"
          class="form-input"/>
      </div>

      <!-- Fecha de Vencimiento -->
      <div class="form-field full-width">
        <label for="fechaVencimiento" class="form-label">
          <i class="pi pi-calendar"></i>
          Fecha de Vencimiento de Pago *
        </label>
        <p-datePicker 
          [(ngModel)]="fechaVencimientoDate" 
          inputId="fechaVencimiento"
          dateFormat="dd/mm/yy"
          [showIcon]="true"
          placeholder="Seleccione una fecha"
          class="w-full">
        </p-datePicker>
      </div>

    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      icon="pi pi-times" 
      (onClick)="cerrarDialog()" 
      severity="secondary"
      [text]="true">
    </p-button>
    <p-button 
      [label]="esEdicion ? 'Actualizar' : 'Guardar'" 
      icon="pi pi-check" 
      (onClick)="guardarSocio()"
      [loading]="loading">
    </p-button>
  </ng-template>
</p-dialog>

<!-- üé® DI√ÅLOGO: Historial de Env√≠os -->
<p-dialog 
  [(visible)]="displayHistorialDialog" 
  [modal]="true" 
  [style]="{width: '900px'}"
  [draggable]="false"
  [resizable]="false"
  header="üìú Historial de Env√≠os">
  
  <div class="historial-content">
    <p-table 
      [value]="historialEnvios" 
      [paginator]="true" 
      [rows]="5"
      responsiveLayout="scroll">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha/Hora</th>
          <th>N√∫mero</th>
          <th>Estado</th>
          <th>Mensaje</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-registro>
        <tr>
          <td>{{ formatearFechaHora(registro.fechaEnvio) }}</td>
          <td>{{ registro.numeroDestino }}</td>
          <td>
            <p-tag 
              [value]="registro.estado" 
              [severity]="getEstadoEnvioBadge(registro.estado)">
            </p-tag>
          </td>
          <td>
            <span *ngIf="registro.estado === 'EXITOSO'">{{ registro.mensaje }}</span>
            <span *ngIf="registro.estado === 'FALLIDO'" class="error-text">{{ registro.mensajeError }}</span>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4" class="text-center">No hay registros de env√≠os para este socio</td>
        </tr>
      </ng-template>

    </p-table>
  </div>
</p-dialog>

<!-- üé® DI√ÅLOGO: Test de Mensaje -->
<p-dialog 
  [(visible)]="displayTestDialog" 
  [modal]="true" 
  [style]="{width: '500px'}"
  [draggable]="false"
  [resizable]="false"
  header="üì± Enviar Mensaje de Prueba">
  
  <div class="dialog-content">
    <div class="form-grid">
      
      <div class="form-field full-width">
        <label for="numeroTest" class="form-label">
          <i class="pi pi-phone"></i>
          N√∫mero de WhatsApp *
        </label>
        <input 
          type="text" 
          pInputText 
          id="numeroTest"
          [(ngModel)]="numeroTest" 
          placeholder="59175123456"
          class="form-input"/>
        <small class="form-hint">Incluir c√≥digo de pa√≠s</small>
      </div>

      <div class="form-field full-width">
        <label for="mensajeTest" class="form-label">
          <i class="pi pi-comment"></i>
          Mensaje
        </label>
        <textarea 
          pTextarea 
          id="mensajeTest"
          [(ngModel)]="mensajeTest" 
          rows="4"
          placeholder="Escribe tu mensaje..."
          class="form-input">
        </textarea>
      </div>

    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar" 
      icon="pi pi-times" 
      (onClick)="displayTestDialog = false" 
      severity="secondary"
      [text]="true">
    </p-button>
    <p-button 
      label="Enviar Mensaje" 
      icon="pi pi-send" 
      (onClick)="enviarMensajePrueba()"
      [loading]="loadingEnvio">
    </p-button>
  </ng-template>
</p-dialog>

<!-- üé® DI√ÅLOGO: Registros de Env√≠os -->
<p-dialog 
  [(visible)]="displayRegistrosDialog" 
  [modal]="true" 
  [style]="{width: '95%', maxWidth: '1200px'}"
  [draggable]="false"
  [resizable]="false"
  header="üìä Todos los Registros de Env√≠os">
  
  <div class="registros-content">
    
    <!-- Filtros de Registros -->
    <div class="registros-filters">
      <div class="search-wrapper">
        <i class="pi pi-search"></i>
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="busquedaRegistro"
          (input)="aplicarFiltrosRegistros()"
          placeholder="Buscar por n√∫mero o mensaje..." 
          class="search-input"/>
      </div>

      <p-selectButton 
        [options]="[
          {label: 'Todos', value: 'TODOS'},
          {label: 'Exitosos', value: 'EXITOSO'},
          {label: 'Fallidos', value: 'FALLIDO'}
        ]" 
        [(ngModel)]="filtroEstadoRegistro"
        (onChange)="aplicarFiltrosRegistros()"
        optionLabel="label"
        optionValue="value">
      </p-selectButton>

      <p-button 
        label="Limpiar" 
        icon="pi pi-filter-slash" 
        (onClick)="limpiarFiltrosRegistros()"
        severity="secondary"
        [text]="true">
      </p-button>

      <p-button 
        label="Exportar CSV" 
        icon="pi pi-download" 
        (onClick)="exportarRegistrosCSV()"
        severity="help">
      </p-button>
    </div>

    <!-- Resumen de Registros -->
    <div class="registros-summary">
      <div class="summary-card">
        <i class="pi pi-list"></i>
        <div>
          <span class="summary-value">{{ registrosFiltrados.length }}</span>
          <span class="summary-label">Total</span>
        </div>
      </div>
      <div class="summary-card success">
        <i class="pi pi-check-circle"></i>
        <div>
          <span class="summary-value">{{ contarPorEstado('EXITOSO') }}</span>
          <span class="summary-label">Exitosos</span>
        </div>
      </div>
              <div class="summary-card danger">
        <i class="pi pi-times-circle"></i>
        <div>
          <span class="summary-value">{{ contarPorEstado('FALLIDO') }}</span>
          <span class="summary-label">Fallidos</span>
        </div>
      </div>
    </div>

    <!-- Tabla de Registros -->
    <p-table 
      [value]="registrosFiltrados" 
      [paginator]="true" 
      [rows]="10"
      [loading]="loadingRegistros"
      responsiveLayout="scroll"
      [rowHover]="true"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros">
      
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="fechaEnvio">
            Fecha/Hora
            <p-sortIcon field="fechaEnvio"></p-sortIcon>
          </th>
          <th>Socio</th>
          <th pSortableColumn="numeroDestino">
            N√∫mero
            <p-sortIcon field="numeroDestino"></p-sortIcon>
          </th>
          <th pSortableColumn="estado">
            Estado
            <p-sortIcon field="estado"></p-sortIcon>
          </th>
          <th>Mensaje/Error</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-registro>
        <tr>
          <td>{{ formatearFechaHora(registro.fechaEnvio) }}</td>
          <td>
            <span class="socio-nombre">{{ registro.nombreSocio || 'N/A' }}</span>
          </td>
          <td>
            <div class="contact-info">
              <i class="pi pi-phone"></i>
              <span>{{ registro.numeroDestino }}</span>
            </div>
          </td>
          <td>
            <p-tag 
              [value]="registro.estado" 
              [severity]="getEstadoEnvioBadge(registro.estado)"
              [icon]="registro.estado === 'EXITOSO' ? 'pi pi-check' : 'pi pi-times'">
            </p-tag>
          </td>
          <td>
            <span *ngIf="registro.estado === 'EXITOSO'" class="mensaje-preview">
              {{ registro.mensaje | slice:0:50 }}{{ registro.mensaje?.length > 50 ? '...' : '' }}
            </span>
            <span *ngIf="registro.estado === 'FALLIDO'" class="error-text">
              <i class="pi pi-exclamation-triangle"></i>
              {{ registro.mensajeError }}
            </span>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5">
            <div class="empty-state-small">
              <i class="pi pi-inbox"></i>
              <p>No hay registros que mostrar</p>
            </div>
          </td>
        </tr>
      </ng-template>

    </p-table>
  </div>
</p-dialog>

<!-- üéØ Componentes de PrimeNG -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>